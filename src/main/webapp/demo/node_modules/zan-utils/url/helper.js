(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(['module', 'exports', './readConfig'], factory);
  } else if (typeof exports !== "undefined") {
    factory(module, exports, require('./readConfig'));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod, mod.exports, global.readConfig);
    global.helper = mod.exports;
  }
})(this, function (module, exports, _readConfig) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _readConfig2 = _interopRequireDefault(_readConfig);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function getCdnImageUrl(url) {
    var parameter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

    if (!url) {
      return (0, _readConfig2['default'])('url.cdn_static') + '/image/wap/no_pic.png';
    }

    var CDN_DOMAIN = 'yzcdn.cn/';
    var containSize = url.match(/.+!\d+x\d+.+/);
    var containProtocal = url.match(/^(https?:)?\/\//i);
    var isCDNImage = url.indexOf(CDN_DOMAIN) !== -1;

    // 若未指定尺寸，且为 yzcdn 域名，则默认指定 100 * 100 尺寸
    if (!containSize && !parameter && (isCDNImage || !containProtocal)) {
      parameter = '!100x100.jpg';
    }

    if (!containProtocal) {
      url = url[0] !== '/' ? '/' + url : url;
      return '' + (0, _readConfig2['default'])('url.imgqn') + url + parameter;
    }

    var DOMAIN_REG_ARRAY = [/^(https?:)?\/\/imgqn.koudaitong.com/, /^(https?:)?\/\/kdt-img.koudaitong.com/, /^(https?:)?\/\/img.yzcdn.cn/, /^(https?:)?\/\/dn-kdt-img.qbox.me/];

    for (var i = 0; i < DOMAIN_REG_ARRAY.length; i++) {
      // eslint-disable-line
      // 并不是所有的域都支持HTTPS，所以把这些域替换成支持HTTPS的
      url = url.replace(DOMAIN_REG_ARRAY[i], (0, _readConfig2['default'])('url.imgqn'));
    }

    return url + parameter;
  }

  function site() {
    var url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
    var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

    var env = (0, _readConfig2['default'])('env');
    var base = (0, _readConfig2['default'])('url');
    if (prefix === 'static' && env === 'online') {
      prefix = 'cdn_static';
    }
    var result = url;
    prefix = prefix ? base[prefix] || '' : '';
    if (url.search(/^http[s]?:\/\//) === -1) {
      if (url[0] !== '/') {
        url = '/' + url;
      }
      result = prefix + url;
    }
    return result;
  }

  /**
   * @memberof module:url
   * @name helper
   * @description
   * ### 对URL的操作
   * 1. **helper.getCdnImageUrl**: 获取图片 CDN 地址
   *
   *  - 参数1：**url(string)**，url 图片 URL
   *  - 参数2：**parameter(string)**，后缀参数
   *  - 返回值：格式化后的图片 URL
   *
   *  ```js
   *  helper.getCdnImageUrl();
   *  // "https://b.yzcdn.cn/v2/image/wap/no_pic.png"
   *  ```
   * 2. **helper.site**: 根据环境拼接 URL
   *
   *  - 参数1：**url(string)** 指定的URL
   *  - 参数2：**prefix(string)** 域名前缀类型
   *  - 返回值：处理后的 URL
   *
   *  ```js
   *  helper.site('test.html');
   *  // "/test.html"
   *  ```
  */
  exports['default'] = {
    site: site,
    getCdnImageUrl: getCdnImageUrl
  };
  module.exports = exports['default'];
});